import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetAddress;
import java.nio.ByteBuffer;

/**
 *  A simple datagram server
 *  Shows how to send and receive UDP packets in Java
 *
 *  @author  P. Tellenbach, http://www.heimetli.ch
 *  @version V1.01
 */

public class DatagramServer
{
   private final static int PACKETSIZE = 1024 ;

   private static String[] respo = new String[]{59,45,52,43,20,00,68,00,01,01,00,00,00,00,00,00,39,39,39,39,39,39,39,39,8a,00,01,00,01,02,00,00,01,00,00,00,00,00,00,00,01,00,00,00,e8,03,00,00,11,00,00,00,fc,c7,0e,00,7c,ce,00,00,6b,19,05,00,ff,0d,ed,ff,d4,45,f2,ff,b4,7a,f7,ff,00,00,00,00,00,00,00,00,00,00,00,00,01,00,00,00,03,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00};
   public static void main( String args[] )
   {
      // Check the arguments
      if( args.length != 1 )
      {
         System.out.println( "usage: DatagramServer port" ) ;
         return ;
      }

      try
      {
         // Convert the argument to ensure that is it valid
         int port = Integer.parseInt( args[0] ) ;

         // Construct the socket
         DatagramSocket socket = new DatagramSocket( port ) ;

         System.out.println( "The server is ready..." ) ;


         for( ;; )
         {
            // Create a packet
            DatagramPacket packet = new DatagramPacket( new byte[PACKETSIZE], PACKETSIZE ) ;

            // Receive a packet (blocking)
            socket.receive( packet ) ;

            // Print the packet
            System.out.println( packet.getAddress() + " " + packet.getPort() + ": " + new String(packet.getData()) ) ;

            
            // Return the packet to the sender
            
            //retrive packet's information to send back response
            InetAddress clientIP = packet.getAddress();
            int clientPort = packet.getPort();
            DatagramPacket response = new DatagramPacket(respo,respo.length,clientIP,clientPort );
            socket.send( response ) ;
            System.out.println("Send to client IP : port are "+ clientIP.toString() +" @"+ clientPort);
            int data = ByteBuffer.wrap(response.getData()).getInt();
            System.out.println("Send response is : " + data);
            
        }  
     }
     catch( Exception e )
     {
        System.out.println( e ) ;
     }
  }
}